<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>用户登录</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="../../js/mui.min.js"  charset="utf-8"></script>
		<link rel="stylesheet"  href="../../css/mui.min.css"  />
		<link rel="stylesheet"  href="../../css/app.css"  />
		<link rel="stylesheet"  href="../../css/login.css"  />
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-transparent">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		</header>
		<div class='zwf'></div>
		
		<div class='title'>登录</div>
		<form>
			<div class="mui-input-row local-relative">
				<input type="text" class="my-placehoder" placeholder="手机号" id="mobile">
				<button id="defaultyzm" type="button" class="button local-absolute">获取验证码</button>
			</div>
			<div class="mui-input-row">
				<input type="text" class="my-placehoder" placeholder="验证码" id="code">
			</div>
			<div class="loginbutton">
				<button type="button" id="denglu" data-loading-text="&nbsp;"  data-loading-icon="mui-spinner mui-spinner-custom">登录</button>
			</div>
		</form>
		
		
		
		<div id="div"></div>
		<div id="popover" class="mui-popover">
			<div class="header">
				<a class="mui-icon mui-pull-right"></a>
				<h1 class="mui-title">用户协议</h1>
			</div>
			<div class="mui-scroll-wrapper" style="top: 44px; bottom: 48px;">
			  <div class="mui-scroll">
			   	<div class="pact">
					<div>
					    <div>
					        在此特别提醒用户认真阅读、充分理解本《服务协议》（下称《协议》）--- 用户应认真阅读、充分理解本《协议》中各条款，包括免除或者限制菜将军责任的免责条款及对用户的权利限制条款。请您审慎阅读并选择接受或不接受本《协议》（未成年人应在法定监护人陪同下阅读）。除非您接受本《协议》所有条款，否则您无权注册、登录或使用本协议所涉相关服务。您的注册、登录、使用等行为将视为对本《协议》的接受，并同意接受本《协议》各项条款的约束。<br/>
					        本《协议》是您（下称“用户”）与菜将军公司（下称“菜将军”）之间关于用户注册、登录、使用“菜将军交交”服务所订立的协议。本《协议》描述菜将军与用户之间关于“菜将军交交”服务相关方面的权利义务。“用户”是指注册、登录、使用、浏览本服务的个人或组织。<br/>
					        您对本协议的接受即受全部条款的约束，包括接受菜将军公司对任一服务条款随时所做的任何修改。本《协议》可由菜将军随时更新，更新后的协议条款一旦公布即代替原来的协议条款，恕不再另行通知，用户可在本网站查阅最新版协议条款。在菜将军修改《协议》条款后，如果用户不接受修改后的条款，请立即停止使用菜将军提供的服务，用户继续使用菜将军提供的服务将被视为已接受了修改后的协议。<br/>
					    </div>
					</div>
				  	<div>
				      	<h4>一、使用规则</h4>
				      	<ol>
					        <li>用户充分了解并同意，菜将军交交仅为用户提供信息分享、传送及获取的平台，用户必须为自己注册帐号下的一切行为负责，包括您所传送的任何内容以及由此产生的任何结果。用户应对菜将军交交中的内容自行加以判断，并承担因使用内容而引起的所有风险，包括因对内容的正确性、完整性或实用性的依赖而产生的风险。菜将军公司无法且不会对因用户行为而导致的任何损失或损害承担责任。</li>
					
					        <li>用户在菜将军交交服务中或通过菜将军交交服务所传送的任何内容并不反映菜将军公司的观点或政策，菜将军公司对此不承担任何责任。</li>
					
					        <li>用户充分了解并同意，菜将军交交是一个陌生人基于用户身份标签交流的即时通讯产品，用户须对在菜将军交交上的注册信息的真实性、合法性、有效性承担全部责任，用户不得冒充他人；不得利用他人的名义传播任何信息；不得恶意使用注册帐号导致其他用户误认；否则菜将军公司有权立即停止提供服务，收回菜将军交交帐号并由用户独自承担由此而产生的一切法律责任。</li>
					
					        <li>用户须对在菜将军交交上所传送信息的真实性、合法性、无害性、有效性等全权负责，与用户所传播的信息相关的任何法律责任由用户自行承担，与菜将军无关。</li>
					
					        <li>菜将军保留因业务发展需要，单方面对本服务的全部或部分服务内容在任何时候不经任何通知的情况下变更、暂停、限制、终止或撤销菜将军交交服务的权利，用户需承担此风险。</li>
					
					        <li>菜将军交交提供的服务中可能包括广告，用户同意在使用过程中显示菜将军交交和第三方供应商、合作伙伴提供的广告。</li>
					
					        <li>用户不得利用菜将军交交或菜将军交交服务制作、上载、复制、发送如下内容：
					            <br/>
					            <ol>
					              <li>反对宪法所确定的基本原则的；</li>
					              <li>危害国家安全，泄露国家秘密，颠覆国家政权，破坏国家统一的</li>
					              <li>损害国家荣誉和利益的；</li>
					              <li>煽动民族仇恨、民族歧视，破坏民族团结的；</li>
					              <li>破坏国家宗教政策，宣扬邪教和封建迷信的；</li>
					              <li>散布谣言，扰乱社会秩序，破坏社会稳定的；</li>
					              <li>散布淫秽、色情、赌博、暴力、凶杀、恐怖或者教唆犯罪的；</li>
					              <li>侮辱或者诽谤他人，侵害他人合法权益的；</li>
					              <li>含有法律、行政法规禁止的其他内容的信息。</li>
					            </ol>
					        </li>
				
					        <li>
					          菜将军公司可依其合理判断，对违反有关法律法规或本协议约定；或侵犯、妨害、威胁任何人权利或安全的内容，或者假冒他人的行为，菜将军公司有权依法停止传输任何前述内容，并有权依其自行判断对违反本条款的任何人士采取适当的法律行动，包括但不限于，从菜将军交交服务中删除具有违法性、侵权性、不当性等内容，终止违反者的成员资格，阻止其使用菜将军交交全部或部分服务，并且依据法律法规保存有关信息并向有关部门报告等。
					        </li>
					        <li>
					          用户权利及义务：
					          <br/>
					          <ol>
					            <li>菜将军交交帐号的所有权归菜将军公司所有，用户完成申请注册手续后，获得菜将军交交帐号的使用权，该使用权仅属于初始申请注册人，禁止赠与、借用、租用、转让或售卖。菜将军公司因经营需要，有权回收用户的菜将军交交帐号。</li>
					            <li>用户有权更改、删除在菜将军交交上的个人资料、注册信息及传送内容等，但需注意，删除有关信息的同时也会删除任何您储存在系统中的文字和图片。用户需承担该风险。</li>
					            <li>用户有责任妥善保管注册帐号信息及帐号密码的安全，用户需要对注册帐号以及密码下的行为承担法律责任。用户同意在任何情况下不使用其他成员的帐号或密码。在您怀疑他人在使用您的帐号或密码时，您同意立即通知菜将军公司。</li>
					            <li>用户应遵守本协议的各项条款，正确、适当地使用本服务，如因用户违反本协议中的任何条款，菜将军公司有权依据协议终止对违约用户菜将军交交帐号提供服务。同时，菜将军保留在任何时候收回菜将军交交帐号、用户名的权利。</li>
					            <li>如果用户有自己的常用英文帐号，那么用户有优先将该英文帐号注册为交交帐号的权利，但是如果用户在菜将军交交服务上线后一段时间内没有注册交交帐号，或者用户虽然注册了交交帐号，但是并不是使用该英文帐号作为交交帐号的，视为用户放弃了将该英文帐号注册为交交帐号的权利，菜将军公司有权将该英文帐号回收并分配给其他用户使用，以免造成资源浪费，由此带来问题均由用户自行承担。</li>
					            <li>用户注册菜将军交交帐号后如果长期不登录该帐号，菜将军有权回收该帐号，以免造成资源浪费，由此带来问题均由用户自行承担。</li>
					          </ol>
					        </li>
				
				     	 </ol>
					</div>
				  	<div>
					    <h4>二、隐私保护</h4>
					    <div>
					      用户同意个人隐私信息是指那些能够对用户进行个人辨识或涉及个人通信的信息，包括下列信息：用户真实姓名，身份证号，手机号码，IP地址。而非个人隐私信息是指用户对本服务的操作状态以及使用习惯等一些明确且客观反映在菜将军服务器端的基本记录信息和其他一切个人隐私信息范围外的普通信息；以及用户同意公开的上述隐私信息；<br/>
					      尊重用户个人隐私信息的私有性是菜将军的一贯制度，菜将军将会采取合理的措施保护用户的个人隐私信息，除法律或有法律赋予权限的政府部门要求或用户同意等原因外，菜将军未经用户同意不向除合作单位以外的第三方公开、 透露用户个人隐私信息。 但是，用户在注册时选择同意，或用户与菜将军及合作单位之间就用户个人隐私信息公开或使用另有约定的除外，同时用户应自行承担因此可能产生的任何风险，菜将军对此不予负责。同时，为了运营和改善菜将军的技术和服务，菜将军将可能会自行收集使用或向第三方提供用户的非个人隐私信息，这将有助于菜将军向用户提供更好的用户体验和提高菜将军的服务质量。<br/>
					      用户同意，在使用菜将军交交服务时也同样受菜将军隐私政策的约束。当您接受本协议条款时，您同样认可并接受菜将军公司隐私政策的条款。<br/>
					    </div>
				  	</div>
				  	<div>
					    <h4>三、菜将军交交商标信息</h4>
					    <div>
					      菜将军交交服务中所涉及的logo、文字或其组成，以及其他菜将军标志及产品、服务名称，均为菜将军公司之商标（以下简称“菜将军标识”）。未经菜将军事先书面同意，用户不得将菜将军标识以任何方式展示或使用或作其他处理，也不得向他人表明您有权展示、使用、或其他有权处理菜将军标识的行为。 <br/>
					    </div>
					</div>
					<div>
						<h4> 四、法律责任及免责</h4>
					    <ol>
					      <li>用户违反本《协议》或相关的服务条款的规定，导致或产生的任何第三方主张的任何索赔、要求或损失，包括合理的律师费，用户同意赔偿菜将军与合作公司、关联公司，并使之免受损害。</li>
					      <li>用户因第三方如电信部门的通讯线路故障、技术问题、网络、电脑故障、系统不稳定性及其他各种不可抗力原因而遭受的一切损失，菜将军及合作单位不承担责任。</li>
					      <li>因技术故障等不可抗事件影响到服务的正常运行的，菜将军及合作单位承诺在第一时间内与相关单位配合，及时处理进行修复，但用户因此而遭受的一切损失，菜将军及合作单位不承担责任。</li>
					      <li>本服务同大多数互联网服务一样，受包括但不限于用户原因、网络服务质量、社会环境等因素的差异影响，可能受到各种安全问题的侵扰，如他人利用用户的资料，造成现实生活中的骚扰；用户下载安装的其它软件或访问的其他网站中含有“特洛伊木马”等病毒，威胁到用户的计算机信息和数据的安全，继而影响本服务的正常使用等等。用户应加强信息安全及使用者资料的保护意识，要注意加强密码保护，以免遭致损失和骚扰。</li>
					      <li>用户须明白，使用本服务因涉及Internet服务，可能会受到各个环节不稳定因素的影响。因此，本服务存在因不可抗力、计算机病毒或黑客攻击、系统不稳定、用户所在位置、用户关机以及其他任何技术、互联网络、通信线路原因等造成的服务中断或不能满足用户要求的风险。用户须承担以上风险，菜将军公司不作担保。对因此导致用户不能发送和接受阅读信息、或接发错信息，菜将军公司不承担任何责任。</li>
					      <li>用户须明白，在使用本服务过程中存在有来自任何他人的包括威胁性的、诽谤性的、令人反感的或非法的内容或行为或对他人权利的侵犯（包括知识产权）的匿名或冒名的信息的风险，用户须承担以上风险，菜将军公司和合作公司对本服务不作任何类型的担保，不论是明确的或隐含的，包括所有有关信息真实性、适商性、适于某一特定用途、所有权和非侵权性的默示担保和条件，对因此导致任何因用户不正当或非法使用服务产生的直接、间接、偶然、特殊及后续的损害，不承担任何责任。</li>
					      <li>菜将军公司定义的信息内容包括：文字、软件、声音、相片、录像、图表；在广告中全部内容；菜将军公司为用户提供的商业信息，所有这些内容受版权、商标权、和其它知识产权和所有权法律的保护。所以，用户只能在菜将军公司和广告商授权下才能使用这些内容，而不能擅自复制、修改、编纂这些内容、或创造与内容有关的衍生产品。</li>
					      <li>在任何情况下，菜将军公司均不对任何间接性、后果性、惩罚性、偶然性、特殊性或刑罚性的损害，包括因用户使用菜将军交交服务而遭受的利润损失，承担责任（即使菜将军交交已被告知该等损失的可能性亦然）。尽管本协议中可能含有相悖的规定，菜将军公司对您承担的全部责任，无论因何原因或何种行为方式，始终不超过您在成员期内因使用菜将军交交服务而支付给菜将军公司的费用(如有) 。</li>
					    </ol>
				  	</div>
					<div>
					    <h4>五、其他条款</h4>
					    <ol>
					      <li>菜将军公司郑重提醒用户注意本《协议》中免除菜将军公司责任和加重用户义务的条款，请用户仔细阅读，自主考虑风险。未成年人应在法定监护人的陪同下阅读本《协议》。以上各项条款内容的最终解释权及修改权归菜将军公司所有。</li>
					      <li>本《协议》所定的任何条款的部分或全部无效者，不影响其它条款的效力。</li>
					      <li>本《协议》签订地为黄石。本《协议》的解释、效力及纠纷的解决，适用于中华人民共和国法律。若用户和菜将军之间发生任何纠纷或争议，首先应友好协商解决，协商不成的，用户在此完全同意将纠纷或争议提交菜将军住所地地即黄石市有管辖权的人民法院管辖。</li>
					      <li>本《协议》的版权由菜将军所有，菜将军保留一切解释和修改权利。</li>
					      <li>若您对菜将军公司及本服务有任何意见，欢迎垂询菜将军公司客服中心。</li>
					    </ol>
				  	</div>
		
				  	<div class='bottom'>
					    <div class='bottom-left'>菜将军客户服务热线：0714-5331900，服务网站：www.ijiaojiao.com.cn</div>
					
					    <div class='bottom-right'>黄石菜将军电子商务有限公司</div>
					
					    <div class='clearfix'></div>
					
				  	</div>
			   	</div>
			  </div>
			</div>
			<div class='footer'>
			  	<div class="my-btn-cancle" id='btn_cancle' >不同意</div>
			  	<div class="my-btn-reg" id='btn_reg'>同意</div>
			</div>		
		</div>
		
		<script type="text/javascript" src="../../js/app.js" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			app.init({}, true, false, false);
			
			var dlYzm = 0;  //获取验证码状态
			var reg_status = 0;  // 0：注册页面     1：注册标签页面
			var btn_chk;  //获取验证码按钮
			var btn_sumbit;  //登录按钮
			var phone; //手机号
			var code;  //验证码
			
			function Ready(){
				btn_chk = document.getElementById('defaultyzm'); 
				btn_sumbit = document.getElementById('denglu');  
				phone = document.getElementById('mobile'); 
				code = document.getElementById('code');  
				
				phone.value = lmobile;
				dlYzm = window.localStorage.getItem('dlYzm') ? window.localStorage.getItem('dlYzm') : 0; // 是否获取验证码验证( // 是否获取验证码验证(后期再使用)
				app.scroll(true, 'mui-scroll-wrapper');
			}
			
			/*初始化按钮*/
			function setInit(){
				if(app.chk(phone.value)){
					btn_chk.style.backgroundColor="green";
					btn_sumbit.style.backgroundColor="#d7d7d7";
				}else{
				    btn_chk.style.backgroundColor="#d7d7d7";
				    btn_sumbit.style.backgroundColor="#d7d7d7";
				}
			}
			
			Ready();
			setInit();
			
			/*协议弹出层*/
			app.listen(document, 'zc_popover', function(){
				g_mui("#popover").popover('toggle', document.getElementById("div"));
			});
				
			
			
			/* 检测手机号是否合法  */
			app.listen(phone, 'input', function(e){
				/*只能输入数字*/
				phone.value=phone.value.replace(/[^0-9-]+/,'');
				if(phone.value.length>11){
					phone.value = phone.value.substring(0, 11);
				}
		  		setInit();
			});
			
			
			/*输完手机号 回车*/
			app.listen(phone, 'keyup',function(e){
				e = event || window.event;
				if(e.keyCode == 13){
					if(!app.chk(phone.value)){
						//弹出错误信息
					}else{
						g_mui.trigger(defaultyzm,'touchstart');
					}
				}
			});
			
			var wait = 60;  // 60s获取一次验证码
			var InterValObj; //定时器
			var count = wait; //间隔函数，1秒执行
			var curCount; //当前剩余秒数
			var is_receive = false;  //是否正在接收短信
			
			/* 验证码按钮触摸事件 */
			app.listen(btn_chk,'touchstart',function(){
				if(!app.chk(phone.value)){
					msg = '请输入正确的手机号'
					options = {};
					options.verticalAlign = 'middle';
					app.toast(msg, options);
					return;
				}
				
				
				btn_chk.style.backgroundColor="#d7d7d7";
				if(is_receive == false){ 
					phone.readOnly=true;
				    curCount = count;
					InterValObj = window.setInterval(SetRemainTimes, 1000);  //倒计时
				}
				
				url = '/Api/Member/GetMember';
       			app.ajax(url, {mobile:mb}, function(data){
       				member_info = data.data;  
       				msg = '';  //显示消息 
       				if(data.code != 0){
						reg_status = 0;
					}else{
						reg_status = member_info.step;
					}
					 
       				if(reg_status != 2){   // 未注册
						reg_dialog();
						return;
					}else{
						btn_chk.style.backgroundColor="#d7d7d7";
						if(is_receive == false){ 
							is_receive = true;
						    sendMobile(); //发送验证码
					    }
					}
       			});
			});
			
			//倒计时
			function SetRemainTimes() {
			  	if(curCount == 0) {
			    	is_receive = false;
				    window.clearInterval(InterValObj); //停止计时器
				    phone.readOnly=false;
				    btn_chk.style.backgroundColor="green";
				    defaultyzm.innerText = "重新发送";
				} else {
				    curCount--;
				    defaultyzm.innerText = curCount + "秒重新发送";
				}
			}
			
			/* 发送验证码  */
			function sendMobile() {
				window.localStorage.setItem('lmobile', phone.value);
				app.ajax('/Member/SendVerify', { mobile: phone.value }, function(yzm_result){
					if( yzm_result.code != 0){
						var msg = '获取验证码失败';
						var options = {};
						options.verticalAlign = 'middle';
						app.toast(msg, options);
						curCount = 0;
					}else{
						//成功发送验证码成功  设置 dlYzm = 1;  登录不成功可一直保留
						dlYzm = 1;
					}
				});
			}
			
			function reg_dialog(){
				var btnArray = ['否', '是'];
				if(reg_status == 0){
					g_mui.confirm('该手机尚未注册,是否注册', '注册提醒', btnArray, function(e) {
						if (e.index == 1) {
							g_mui.trigger(document, 'zc_popover');
						} 
					});
				}else{
					g_mui.confirm('是否完善注册信息', '注册提醒', btnArray, function(e) {
						if (e.index == 1) {
							g_mui.trigger(document, 'zc_popover');
						} 
					});
				}
			}
			
						
			var btn_cancle = document.getElementById("btn_cancle");  //不同意按钮
			var btn_reg = document.getElementById("btn_reg");   //同意按钮
			/*关闭协议*/
			app.listen(btn_cancle, "tap",function(){
				g_mui.trigger(document, 'zc_popover');
			});
			
			/*注册*/
		   	app.listen(btn_reg, "tap",function(){
		   		g_mui.trigger(document, 'zc_popover');
				regedit();
			});
			
			function regedit(){
				args = {};
				window.localStorage.setItem('zmobile', phone.value);
		   		if(reg_status == 0){
		   			args.url = "regedit.html";
		   			args.id = "reg";
		   		}else{
		   			args.url = "regtag.html";
		   			args.id = "regtag";
		   		}
		   		app.open(args);
		   	}
			
			
			/*登录*/
			app.listen(btn_sumbit, 'tap',function(){
				g_mui(btn_sumbit).button('loading');
				
				setTimeout(function() {
		            g_mui(btn_sumbit).button('reset');
		        }.bind(btn_sumbit), 3000);
				
//				if(!app.chk(phone.value)){
//					msg = '请输入正确的手机号';
//					options = {};
//					options.verticalAlign = 'middle'
//					app.toast(msg, options);
//					return;
//				}
//				
//				if(dlYzm != 1 || code.value.trim() == '') {
//					msg = '验证码不正确';
//					options = {};
//					options.verticalAlign = 'middle'
//					app.toast(msg, options);
//					return;
//				}
//				
//				if(reg_status != 2){
//					reg_dialog();
//					return;
//				}
				
				is_receive = false;
				curCount = 0;  //清除 定时器
				
				
				app.ajax('/Member/Login',{
						mobile:phone.value,
		                verifyCode:code.value,
		                uuid:uuid
					},function(data){
						if(data.code != 0){
							window.localStorage.setItem('token', data.data.token);
							window.localStorage.setItem('mb', phone.value);
							window.localStorage.setItem('lmobile', phone.value);
							window.localStorage.setItem('step', 2);
							args = {};
							args.url = '../../main.html';
							args.id = 'main';
							args.show = {};
							args.show.aniShow = 'slide-in-right';
							app.open(args);
						}else{
							
						}
					}
				);
				
		        
			});
		</script>
	</body>

</html>